@model IEnumerable<EstacionamentoMvc.Models.MovimentoEstacionamento>
@{
    // garante que a view sempre conhece o estado do toggle
    bool showAll = ViewBag.ShowAll ?? false;
}

<div class="d-flex justify-content-between align-items-center mb-3" style="flex-wrap:nowrap;">
    <h2 class="mb-0">üöó Ve√≠culos Cadastrados</h2>

    <div class="d-flex align-items-center gap-2 flex-shrink-0">
        <a asp-controller="Estacionamento"
           asp-action="Entrada"
           class="btn btn-success">
            + Entrada Ve√≠culo
        </a>

        <a asp-controller="Estacionamento"
           asp-action="Index"
           asp-route-showAll="@(!showAll)"
           class="btn btn-primary">
            @(showAll ? "üëÅÔ∏è Mostrar Ativos" : "üìã Mostrar Todos")
        </a>
    </div>
</div>


<table class="table table-striped">
    <thead class="table-dark">
        <tr>
            <th>Placa</th>
            <th>Modelo</th>
            <th>Entrada</th>
            <th>Sa√≠da</th>
            <th>Perman√™ncia</th>
            <th>Valor Pago</th>
            <th>A√ß√µes</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Placa</td>
                <td>@item.Modelo</td>
                <td>@item.DataEntrada.ToString("dd/MM/yyyy HH:mm")</td>
                <td>
                    @if (item.DataSaida != null)
                    {
                        @item.DataSaida?.ToString("dd/MM/yyyy HH:mm")
                    }
                    else
                    {
                        <span>Em aberto</span>
                    }
                </td>
                <td>
                    @if (item.MinutosPermanencia > 0)
                    {
                        var horas = item.MinutosPermanencia / 60;
                        var minutos = item.MinutosPermanencia % 60;
                        @($"{horas}h {minutos}min")
                    }
                    else
                    {
                        <span>-</span>
                    }
                </td>
                <td>R$ @(item.ValorPago.HasValue ? item.ValorPago.Value.ToString("N2") : "-")
                <td class="d-flex gap-2">
                    <a asp-action="Detalhes" asp-route-id="@item.Id" class="btn btn-info btn-sm">Detalhes</a>
                    <a asp-action="Baixa" asp-route-id="@item.Id" class="btn btn-success btn-sm">Baixa</a>
                    <a asp-action="Editar" asp-route-id="@item.Id" class="btn btn-warning btn-sm">Editar</a>
                    <a asp-action="Excluir" asp-route-id="@item.Id" class="btn btn-danger btn-sm">Excluir</a> 
                    @* @if (Context.Session.GetString("AdminLogado") == "true")
                    {
                        <a asp-action="Excluir" asp-route-id="@item.Id" class="btn btn-danger">Excluir</a>
                    } *@
                </td>
            </tr>
        }
    </tbody>
</table>
@if (!Model.Any())
{
    <p><em>Nenhum movimento encontrado.</em></p>
}